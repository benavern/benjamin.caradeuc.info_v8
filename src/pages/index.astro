---
import { getCollection } from "astro:content";
import Layout from "../components/Layout.astro";
import BlogPostCard from "../components/ui/BlogPostCard.astro";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  return (await getCollection("blog"))
    .sort((a,b) => Number(b.data.date) - Number(a.data.date))
    .slice(0, 6);
}

const posts = (await getCollection("blog"))
  .sort((a,b) => Number(b.data.date) - Number(a.data.date))
  .slice(0, 6);

const socialLinks = [
  {
    name: "X",
    url: "https://x.com/benavern/",
    icon: "x",
  },
  {
    name: "Github",
    url: "https://www.github.com/benavern/",
    icon: "mdi:github",
  },
  {
    name: "Linkedin",
    url: "https://www.linkedin.com/in/benjamincaradeuc/",
    icon: "mdi:linkedin",
  }
];
---

<Layout
    title="Ingénieur développeur web"
    description="Ingénieur développeur web passionné par le front-end et l'UX. Créateur d'applications web performantes et élégantes.">
    <hero-zone>
        <hgroup scroll-animation-leave="scale">
            <h1>
                Benjamin
                <br>
                CARADEUC
            </h1>

            <p>
                <strong>Ingénieur développeur web</strong> passionné par le front-end et l'UX.
            </p>

            <p>
                Créateur d'applications web <strong>performantes et élégantes</strong>.
            </p>
        </hgroup>

        <a
            role="button"
            href="#page-content"
            class="btn btn--shape-circle">
            <span class="btn__icon">
                <Icon name="mdi:arrow-bottom" />
            </span>

            <span class="sr-only">Passer au contenu</span>
        </a>

        <firefly-background></firefly-background>
    </hero-zone>

    <social-links id="page-content">
        <h2 scroll-animation="slide-inline-start">
            Mes réseaux
        </h2>

        <ul scroll-animation="scale">
            { socialLinks.map((link) => (
                <li>
                    <a
                        role="button"
                        class="btn btn--shape-circle btn--variant-accent-border btn--size-large"
                        href={link.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        aria-label={`Profil ${link.name} de Benjamin Caradeuc`}>
                        <div
                            aria-hidden="true"
                            class="btn__icon">
                            <Icon name={link.icon} />
                        </div>

                        <div class="sr-only">
                            {link.name}
                        </div>
                    </a>
                </li>
            )) }
        </ul>
    </social-links>

    <hr>

    <about-me>
        <h2 scroll-animation="slide-inline-start">
            À propos de moi
        </h2>

        <p>
            En tant que <strong>développeur web fullstack</strong> et <strong>Responsable projets informatiques</strong>, j'exerce actuellement mon talent sur ces sites:
        </p>

        <ul scroll-animation="slide-inline-end">
            <li>
                <a
                    target="_blank"
                    href="https://www.ouestfrance-immo.com">
                    ouestfrance-immo.com
                </a>
            </li>

            <li>
                <a
                    target="_blank"
                    href="https://www.bellespierres.com">
                    bellespierres.com
                </a>
            </li>

            <li>
                <a
                    target="_blank"
                    href="https://www.cessionpme.com">
                    cessionpme.com
                </a>
            </li>
        </ul>

        <p>
            Les technologies que j'emploie au quotidien sont:
        </p>

        <ul scroll-animation="slide-inline-end">
            <li>
                <strong>Front-end:</strong> HTML5, CSS3, JavaScript (es2021+), TypeScript, Vue (2/3), Nuxt (2/3/4), Lit, Svelte, SvelteKit
            </li>

            <li>
                <strong>Back-end:</strong> PHP, Laravel, Node.js
            </li>

            <li>
                <strong>Base de données:</strong> MySQL, PostgreSQL
            </li>
            <li>
                <strong>Outils & Méthodes:</strong> Git, Docker, Kubernetes, CI/CD (Gitlab), Agile Scrum, ...
            </li>
        </ul>

        <p>
            Tout ce que je sais faire dans mon travail, c'est sur internet que je l'ai appris. Il m'a semblé naturel d'en faire profiter à mon tour!
        </p>

        <p>
            Vous êtes donc ici sur mon site, il me permet de partager mes trouvailles, mes réalisations, mes conseils, mes réflexions...
        </p>

        <p>
            N'hésitez pas à fouiner un peu pour trouver votre bonheur. Vous pouvez également <a href="/contact">me contacter</a> ou me faire signe sur les réseaux sociaux.
            Si vous voulez en savoir plus sur mon parcours, c'est par <a href="/parcours">ici</a> que ça se passe!
        </p>
    </about-me>

    <hr>

    <recent-blog-posts>
        <h2>Découvrez les derniers articles du blog</h2>

        <z-carousel
            scroll-animation="slide-inline-end"
            id="home-carousel"
            per-page="1"
            per-move="1"
            gap="16"
            offset-start="0"
            offset-end="0"
            navigation
            dots
            drag>
            { posts.map((post) => <BlogPostCard post={post} />) }

            <a
                role="button"
                class="btn btn--variant-secondary"
                href="/blog/2">
                Voir la page 2...
            </a>

            <span
                role="button"
                class="btn btn--variant-secondary-border btn--shape-circle"
                slot="nav-prev">
                <div aria-hidden="true" class="btn__icon">
                    <Icon name="mdi:arrow-left" />
                </div>

                <div class="sr-only">Page précédente</div>
            </span>

            <span
                role="button"
                class="btn btn--variant-secondary-border btn--shape-circle"
                slot="nav-next">
                <div class="sr-only">Page suivante</div>

                <div aria-hidden="true" class="btn__icon">
                    <Icon name="mdi:arrow-right" />
                </div>
            </span>
        </z-carousel>
    </recent-blog-posts>
</Layout>

<style lang="scss">
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-25%); }
    }

    hero-zone {
        position: relative;
        grid-column: bleed;
        display: grid;
        grid-template-columns: subgrid;
        text-shadow: 0 0 .5em var(--clr-bg);

        a[href="#page-content"] {
            position: absolute;
            inset: auto auto var(--spacing) 50%;
            translate: 0 -50%;
            width: fit-content;
            animation: bounce 0.8s ease-in-out infinite;
        }
    }

    hgroup {
        grid-column: content;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: calc(100dvh - var(--header-height));
        margin: 0;

        p {
            font-size: var(--txt-lg);
        }
    }

    social-links {
        margin-block-start: var(--spacing-lg);

        ul {
            display: flex;
            gap: var(--spacing);
            justify-content: space-evenly;

            li {
                list-style: none;
                font-size: var(--txt-xl);

                a {
                    transition: all 0.3s ease-in-out;

                    &:hover {
                        scale: 1.5;
                    }
                }
            }
        }
    }

    recent-blog-posts {
        grid-column: bleed;
        display: grid;
        grid-template-columns: subgrid;

        & > * {
            grid-column: content;
        }

        & > z-carousel {
            grid-column: bleed;

            > a {
                border-radius: var(--border-radius-lg);
            }
        }
    }

    z-carousel {
        &:not(:defined) {
            padding: var(--spacing-sm) 0;
            gap: var(--spacing);

            > * {
                width: 75%;

                @media (min-width: 82ch) {
                        width: 40%;
                }

                @media (min-width: 160ch) {
                        width: 28%;
                }

                @media (min-width: 240ch) {
                        width: 21%;
                }
            }
        }

        &::part(content) {
            /* Let the shadows and scale pass */
            padding-block: var(--spacing-sm);
        }


        &::part(nav-btn) {
            display: none;

            @media (min-width: 82ch) {
                display: block;
            }
        }

        [slot^="nav-"] {
            backdrop-filter: blur(5px);
        }
    }
</style>


<script>
    import "../components/ui/FireflyBackground.wc";

    const breakpoints = [
        { mq: '(min-width: 240ch)', perPage: 4, perMove: 4, gap: 28, offsetStart: 130, offsetEnd: 130 },
        { mq: '(min-width: 160ch)', perPage: 3, perMove: 3, gap: 24, offsetStart: 100, offsetEnd: 100 },
        { mq: '(min-width: 100ch)',  perPage: 2, perMove: 2, gap: 20, offsetStart: 70, offsetEnd: 70 },
        { mq: '(min-width: 60ch)',  perPage: 1, perMove: 1, gap: 16, offsetStart: 32, offsetEnd: 32 },
        { mq: '(max-width: 59ch)',  perPage: 1, perMove: 1, gap: 16, offsetStart: 8, offsetEnd: 24 },
    ];

    function updateCarousel() {
        const carousel = document.querySelector('#home-carousel');
        if (!carousel) return;

        const match = breakpoints.find(b => window.matchMedia(b.mq).matches);
        if (match) {
            carousel.setAttribute('per-page', String(match.perPage));
            carousel.setAttribute('per-move', String(match.perMove));
            carousel.setAttribute('gap', String(match.gap));
            carousel.setAttribute('offset-start', String(match.offsetStart));
            carousel.setAttribute('offset-end', String(match.offsetEnd));
        }
    }

    // initialisation
    updateCarousel();

    // écoute resize si le viewport change
    for (const bp of breakpoints) {
        const mq = window.matchMedia(bp.mq);
        mq.addEventListener('change', updateCarousel);
    }

    // écoute les swaps Astro SPA pour réinitialiser si nécessaire
    document.addEventListener('astro:after-swap', updateCarousel);
</script>
